<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>ğŸ‰ ë§¥ë¶ ë£°ë › ì´ë²¤íŠ¸ ğŸ‰</title>
  <style>
    body {
      font-family: 'Arial', sans-serif;
      text-align: center;
      padding: 30px;
    }

    #wheel-container {
      position: relative;
      width: 300px;
      height: 300px;
      margin: 0 auto;
    }

    #pointer {
      position: absolute;
      top: -15px;
      left: 50%;
      transform: translateX(-50%);
      width: 0;
      height: 0;
      border-left: 15px solid transparent;
      border-right: 15px solid transparent;
      border-top: 30px solid orange;
      z-index: 10;
    }

    svg {
      transform: rotate(0deg);
      transition: transform 5s cubic-bezier(0.33, 1, 0.68, 1);
      cursor: pointer;
      user-select: none;
    }

    #spin-btn {
      margin-top: 30px;
      padding: 12px 24px;
      font-size: 16px;
      cursor: pointer;
    }

    #result {
      margin-top: 20px;
      font-size: 18px;
      min-height: 24px;
    }

    #macbook-link {
      display: none;
      margin-top: 15px;
      font-weight: bold;
      font-size: 16px;
    }

    #macbook-link a {
      color: orange;
      text-decoration: none;
    }
  </style>
</head>
<body>

<h1>ğŸ‰ ë§¥ë¶ ë£°ë › ì´ë²¤íŠ¸ ğŸ‰</h1>

<div id="wheel-container">
  <div id="pointer" aria-label="ë£°ë › í¬ì¸í„°"></div>
  <svg id="wheel" width="300" height="300" viewBox="0 0 300 300" role="img" aria-describedby="result">
    <g transform="translate(150,150)">
      <!-- ë¶€ì±„ê¼´ ì¡°ê°ê³¼ í…ìŠ¤íŠ¸ëŠ” JSì—ì„œ ë™ì ìœ¼ë¡œ ìƒì„± -->
    </g>
  </svg>
</div>

<button id="spin-btn" aria-controls="wheel" aria-live="polite">ë£°ë › ëŒë¦¬ê¸°</button>
<div id="result" role="alert" aria-live="polite"></div>
<div id="macbook-link" aria-hidden="true">
  ğŸ‘‰ <a href="https://www.coupang.com/np/search?component=&q=ë§¥ë¶+í”„ë¡œ" target="_blank" rel="noopener noreferrer">ë§¥ë¶ ìµœì €ê°€ ë³´ëŸ¬ê°€ê¸°</a>
</div>

<script>
  const sectors = [
    "ê½", "ê½", "ì»¤í”¼ ì¿ í°", "ê½", "ë§¥ë¶ í”„ë¡œ!", "ìŠ¤íƒ€ë²…ìŠ¤ ì¿ í°", "ê½", "ê½"
  ];
  const colors = ["#28a745", "#218838"];
  const sectorCount = sectors.length;
  const sectorAngle = 360 / sectorCount;
  const r = 150;
  const svgGroup = document.querySelector("#wheel g");
  const wheel = document.getElementById("wheel");
  const spinBtn = document.getElementById("spin-btn");
  const result = document.getElementById("result");
  const macbookLink = document.getElementById("macbook-link");
  const STORAGE_KEY = "rouletteSpunDate";
  let currentRotation = 0;
  let isSpinning = false;

  // ë¶€ì±„ê¼´ + í…ìŠ¤íŠ¸ ê·¸ë¦¬ê¸°
  function drawWheel() {
    for(let i = 0; i < sectorCount; i++) {
      const startAngle = i * sectorAngle;
      const endAngle = startAngle + sectorAngle;
      const largeArcFlag = sectorAngle > 180 ? 1 : 0;

      // ì‹œì‘ ì  ì¢Œí‘œ
      const x1 = r * Math.cos((startAngle - 90) * Math.PI / 180);
      const y1 = r * Math.sin((startAngle - 90) * Math.PI / 180);
      // ë ì  ì¢Œí‘œ
      const x2 = r * Math.cos((endAngle - 90) * Math.PI / 180);
      const y2 = r * Math.sin((endAngle - 90) * Math.PI / 180);

      // ë¶€ì±„ê¼´ path
      const path = document.createElementNS("http://www.w3.org/2000/svg", "path");
      path.setAttribute("d", `M0 0 L${x1} ${y1} A${r} ${r} 0 ${largeArcFlag} 1 ${x2} ${y2} Z`);
      path.setAttribute("fill", colors[i % colors.length]);
      svgGroup.appendChild(path);

      // í…ìŠ¤íŠ¸ ìœ„ì¹˜ ë° íšŒì „
      const midAngle = startAngle + sectorAngle / 2;
      const textRadius = 100;
      const textX = textRadius * Math.cos((midAngle - 90) * Math.PI / 180);
      const textY = textRadius * Math.sin((midAngle - 90) * Math.PI / 180);

      const text = document.createElementNS("http://www.w3.org/2000/svg", "text");
      text.setAttribute("x", textX);
      text.setAttribute("y", textY);
      text.setAttribute("fill", "#fff");
      text.setAttribute("font-size", "13");
      text.setAttribute("font-weight", "bold");
      text.setAttribute("text-anchor", "middle");
      text.setAttribute("alignment-baseline", "middle");
      // í…ìŠ¤íŠ¸ê°€ í•­ìƒ ì½ê¸° ì‰¬ìš´ ë°©í–¥ì„ í–¥í•˜ê²Œ íšŒì „
      text.setAttribute("transform", `rotate(${midAngle}, ${textX}, ${textY})`);
      text.textContent = sectors[i];
      svgGroup.appendChild(text);
    }
  }

  // ì˜¤ëŠ˜ ë£°ë › ëŒë ¸ëŠ”ì§€ ì²´í¬
  function hasSpunToday() {
    const lastSpin = localStorage.getItem(STORAGE_KEY);
    if (!lastSpin) return false;
    return new Date(lastSpin).toDateString() === new Date().toDateString();
  }

  // ì˜¤ëŠ˜ ë£°ë › ëŒë ¸ë‹¤ê³  ì €ì¥
  function setSpunToday() {
    localStorage.setItem(STORAGE_KEY, new Date().toISOString());
  }

  // ë£°ë › ëŒë¦¬ê¸° í•¨ìˆ˜
  function spin() {
    if (isSpinning) return; // ì¤‘ë³µ í´ë¦­ ë°©ì§€
    if (hasSpunToday()) {
      alert("í•˜ë£¨ì— í•œ ë²ˆë§Œ ì°¸ì—¬í•  ìˆ˜ ìˆì–´ìš”!");
      return;
    }

    isSpinning = true;
    spinBtn.disabled = true;
    result.textContent = "ëŒë¦¬ëŠ” ì¤‘...";
    macbookLink.style.display = "none";

    // ë‹¹ì²¨ ì¸ë±ìŠ¤ ëœë¤
    const targetIndex = Math.floor(Math.random() * sectorCount);

    // ë£°ë › í¬ì¸í„°ê°€ 12ì‹œ(0ë„) ê¸°ì¤€ì´ë¯€ë¡œ, ë‹¹ì²¨ ì¡°ê° ì¤‘ì•™ì´ 12ì‹œë¡œ ì˜¤ë„ë¡ ê³„ì‚°
    // (360 - (ë‹¹ì²¨ ì¸ë±ìŠ¤ * ì„¹í„° ê°ë„ + ì ˆë°˜ ê°ë„))ë¡œ ë§ì¶¤
    // ì¶”ê°€ë¡œ 5íšŒì „(360*5)í•´ì„œ ëŒë¦¼ íš¨ê³¼
    const spins = 360 * 5 + (360 - (targetIndex * sectorAngle + sectorAngle / 2));
    currentRotation += spins;

    // CSS transformìœ¼ë¡œ íšŒì „ ì• ë‹ˆë©”ì´ì…˜ ì‹œì‘
    wheel.style.transition = "transform 5s cubic-bezier(0.33, 1, 0.68, 1)";
    wheel.style.transform = `rotate(${currentRotation}deg)`;

    // ì• ë‹ˆë©”ì´ì…˜ ì¢…ë£Œ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ
    function onTransitionEnd() {
      wheel.style.transition = "none"; // ì¦‰ì‹œ transition ì œê±°
      // íšŒì „ ê°ë„ë¥¼ 360ë„ ì´ë‚´ë¡œ ì¤„ì—¬ ë¬´í•œ íšŒì „ ë¬¸ì œ í•´ê²°
      currentRotation = currentRotation % 360;
      wheel.style.transform = `rotate(${currentRotation}deg)`;

      // ê²°ê³¼ í‘œì‹œ
      result.textContent = `ğŸ‰ ê²°ê³¼: ${sectors[targetIndex]} ë‹¹ì²¨!`;

      // ë§¥ë¶ ë‹¹ì²¨ ì‹œ ë§í¬ ë³´ì´ê¸°
      if (sectors[targetIndex] === "ë§¥ë¶ í”„ë¡œ!") {
        macbookLink.style.display = "block";
        macbookLink.setAttribute("aria-hidden", "false");
      } else {
        macbookLink.style.display = "none";
        macbookLink.setAttribute("aria-hidden", "true");
      }

      setSpunToday();
      isSpinning = false;
      spinBtn.disabled = false;

      wheel.removeEventListener("transitionend", onTransitionEnd);
    }

    wheel.addEventListener("transitionend", onTransitionEnd);
  }

  // ì´ˆê¸° ì„¸íŒ…
  drawWheel();

  if (hasSpunToday()) {
    spinBtn.disabled = true;
    result.textContent = "ì˜¤ëŠ˜ ì´ë¯¸ ë£°ë ›ì„ ëŒë¦¬ì…¨ìŠµë‹ˆë‹¤. ë‚´ì¼ ë‹¤ì‹œ ë„ì „í•˜ì„¸ìš”!";
    macbookLink.style.display = "block";
    macbookLink.setAttribute("aria-hidden", "false");
  }

  spinBtn.addEventListener("click", spin);
</script>

</body>
</html>
