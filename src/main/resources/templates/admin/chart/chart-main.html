<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>ê´€ë¦¬ì ë©”ì¸</title>
    <link rel="stylesheet" th:href="@{/admin/css/header.css}" />
    <link rel="stylesheet" th:href="@{/admin/css/sidebar.css}" />
    <link rel="stylesheet" th:href="@{/admin/css/base.css}" />
    
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    
    <style>
        .chart-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 24px;
            padding: 24px;
        }

        .chart-box {
            background: #fff;
            border: 1px solid #ddd;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
            padding: 20px;
            position: relative;
            height: 300px; /* âœ… ë„ë„› í¬í•¨ ëª¨ë“  ì°¨íŠ¸ì˜ ë†’ì´ í†µì¼ */
        }

        .chart-box canvas {
            width: 100% !important;
            height: 100% !important;
        }

        h1 {
            padding-left: 24px;
        }
    </style>
    
</head>
<body>

    <!-- ê³µí†µ í—¤ë” -->
    <div th:replace="admin/fragments/header :: header" class="header"></div>

    <div id="body">
        <!-- ì‚¬ì´ë“œë°” -->
        <div th:replace="admin/fragments/sidebar :: sidebar" class="sidebar"></div>

        <!-- ë³¸ë¬¸ -->
        <div class="content">
		    <div class="chart-grid">
                <div class="chart-box">
                    <canvas id="visitChart"></canvas>
                </div>
                <div class="chart-box">
                    <canvas id="productChart"></canvas>
                </div>
                <div class="chart-box">
                    <canvas id="sentimentChart"></canvas>
                </div>
                <div class="chart-box">
                    <canvas id="testResultChart"></canvas>
                </div>
            </div>
		</div>
	</div>
    

	<script th:inline="javascript">
	
		// ë°©ë¬¸ì ìˆ˜ 
		
	    const labels = /*[[${visitLabels}]]*/ [];
	    const counts = /*[[${visitCounts}]]*/ [];
	    console.log("âœ… labels:", labels);
	    console.log("âœ… counts:", counts);
	
	    const ctx = document.getElementById('visitChart').getContext('2d');
	    new Chart(ctx, {
	        type: 'bar',	
	        data: {
	            labels: labels,
	            datasets: [{
	                label: 'ë°©ë¬¸ì ìˆ˜',
	                data: counts,
	                backgroundColor: 'rgba(54, 162, 235, 0.5)',
	                borderColor: 'rgba(54, 162, 235, 1)',
	                borderWidth: 1
	            }]
	        },
	        options: {
	            scales: {
	                y: { 
	                	beginAtZero: true ,
	                	ticks: {
	                		stepSize:1
	                	}	
	                }
	            }
	        }
	    });
	    
	    //==================================================================
	    
	    //ìƒí’ˆ ì¡°íšŒìˆ˜
	    const productLabels = /*[[${labels}]]*/ [];
	    const productCounts = /*[[${counts}]]*/ [];

	    const ctxProduct = document.getElementById('productChart').getContext('2d');
	    new Chart(ctxProduct, {
	        type: 'bar',
	        data: {
	            labels: productLabels,
	            datasets: [{
	                label: 'ìƒí’ˆë³„ ì¡°íšŒìˆ˜',
	                data: productCounts,
	                backgroundColor: 'rgba(54, 162, 235, 0.5)',
	                borderColor: 'rgba(54, 162, 235, 1)',
	                borderWidth: 1
	            }]
	        },
	        options: {
	            indexAxis: 'x', // ìˆ˜í‰ ë§‰ëŒ€ê·¸ë˜í”„
	            responsive: true,
	            scales: {
	                x: {
	                    beginAtZero: true,
	                    title: {
	                        display: false,
	                        text: 'ì¡°íšŒìˆ˜'
	                    }
	                },
	                y: {
	                    title: {
	                        display: true,
	                        text: 'ìƒí’ˆëª…'
	                    }
	                }
	            },
	            plugins: {
	                legend: { display: false },
	                title: {
	                    display: true,
	                    text: 'ğŸ“Š ì¸ê¸° ìƒí’ˆ TOP 10 (ì¡°íšŒìˆ˜ ê¸°ì¤€)'
	                }
	            }
	        }
	    });
	    
	 // =============================================
	 // ë¦¬ë·° ê¸ì • ë¶€ì • í†µê³„ 	 
	
	 const sentimentLabels = /*[[${sentimentLabels}]]*/ [];
	 const sentimentCounts = /*[[${sentimentCounts}]]*/ [];

	 const ctxSentiment = document.getElementById('sentimentChart').getContext('2d');
	 new Chart(ctxSentiment, {
	     type: 'doughnut',  
	     data: {
	         labels: sentimentLabels,
	         datasets: [{
	             label: 'ë¦¬ë·° ê°ì • í†µê³„',
	             data: sentimentCounts,
	             backgroundColor: [
	                 'rgba(75, 192, 192, 0.6)',  // ê¸ì •
	                 'rgba(255, 99, 132, 0.6)'   // ë¶€ì •
	             ],
	             borderColor: [
	                 'rgba(75, 192, 192, 1)',
	                 'rgba(255, 99, 132, 1)'
	             ],
	             borderWidth: 1
	         }]
	     },
	     options: {
	         responsive: true,
	         maintainAspectRatio: false,
	         plugins: {
	             legend: { position: 'top' },
	             title: {
	                 display: true,
	                 text: 'ğŸ‘ ë¦¬ë·° ê°ì • í†µê³„ (ê¸ì • vs ë¶€ì •)'
	             }
	         }
	     }
	 });
	
	 
	 // =============================================
	 // ì†Œë¹„ìœ í˜• ê²°ê³¼ 
	
	 const testResultLabels = /*[[${testResultLabels}]]*/ [];
	 const testResultCounts = /*[[${testResultCounts}]]*/ [];

	 const ctxTestResult = document.getElementById('testResultChart').getContext('2d');
	 new Chart(ctxTestResult, {
	     type: 'bar',
	     data: {
	         labels: testResultLabels,
	         datasets: [{
	             label: 'í…ŒìŠ¤íŠ¸ ê²°ê³¼ ë¶„í¬',
	             data: testResultCounts,
	             backgroundColor: 'rgba(255, 206, 86, 0.5)',
	             borderColor: 'rgba(255, 206, 86, 1)',
	             borderWidth: 1
	         }]
	     },
	     options: {
	         responsive: true,
	         scales: {
	             y: {
	                 beginAtZero: true,
	                 title: {
	                     display: true,
	                     text: 'ì‘ë‹µ ìˆ˜'
	                 },
	     			 ticks:{
	     				 stepSize:5
	     			 }
	             },
	             x: {
	                 title: {
	                     display: true,
	                     text: 'í…ŒìŠ¤íŠ¸ ìœ í˜•'
	                 }
	             }
	         },
	         plugins: {
	             legend: { display: false },
	             title: {
	                 display: true,
	                 text: 'ğŸ§  í…ŒìŠ¤íŠ¸ ê²°ê³¼ í†µê³„'
	             }
	         }
	     }
	 });
	 
	    
	</script>
</body>
</html>
